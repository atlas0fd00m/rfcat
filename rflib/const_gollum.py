APP_SYSTEM_GOLLUM = 0xF1
APP_NIC = 0x42
APP_SPECAN = 0x43
APP_FREQFINDER = 0x44
APP_RF = 0xBF

# APP_SYSTEM_GOLLUM
CMD_PM_SLEEP = 0x8A
CMD_GET_FW_VERSION = 0x90
CMD_DEVICE_SERIAL_NUMBER_GOLLUM = 0x92

# APP_NIC
CMD_NIC_ENCODING_MODE = 0x13
CMD_NIC_RECV_INFINITE_MODE = 0x0E
CMD_NIC_RECV = 0x01
CMD_NIC_RECV_RLE = 0x01
CMD_NIC_REQUEST_REMAINING_DATA = 0x20
CMD_NIC_RECV_REMAINING_DATA = 0x21
CMD_NIC_RECV_REMAINING_DATA_RLE = 0x22
CMD_NIC_XMIT_INFINITE_MODE = 0x12
CMD_NIC_XMIT = 0x02
CMD_NIC_XMIT_RLE = 0x04
CMD_NIC_START_DATARATE_DETECTION = 0x0A
CMD_NIC_STOP_DATARATE_DETECTION = 0x0B
CMD_NIC_DATARATE_DETECTED = 0x0C
CMD_NIC_DATARATE_DETECTED_END = 0x0D
CMD_NIC_RECV_ASYNC_MODE = 0x0F
CMD_NIC_RECV_ASYNC_PROCESSING_ENABLED = 0x10
CMD_NIC_RECV_ASYNC_DATA_NORDIC = 0xF1
CMD_NIC_RECV_ASYNC_DATA_CC1111 = 0xF2

# APP_RF
CMD_RF_SEND_CONFIG = 0x50
CMD_RF_TRANSMIT_DATA = 0x51
CMD_RF_SET_FREQ = 0x52
CMD_RF_SET_POWER = 0x53
CMD_RF_SET_MODULATION = 0x54
CMD_RF_SET_DATARATE = 0x55
CMD_RF_SET_MAXPOWER = 0x56
CMD_RF_SET_RXFILTERBW = 0x57
CMD_RF_SET_PACKETFLEN = 0x58
CMD_RF_SET_SYNCMODE = 0x59
CMD_RF_SET_PKTCRC = 0x60
CMD_RF_SET_CHANSPC = 0x61
CMD_RF_START_JAMMING = 0x62
CMD_RF_STOP_JAMMING = 0x63
CMD_RF_BRUTE_FORCE_SETUP = 0x68                 # Gouv custom
CMD_RF_BRUTE_FORCE_SETUP_LONG_SYMBOL = 0x7B
CMD_RF_BRUTE_FORCE_SETUP_FUNCTION = 0x7A
CMD_RF_BRUTE_FORCE_START = 0x64
CMD_RF_BRUTE_FORCE_START_SYNC_CODE_TAIL = 0x69  # Gouv custom
CMD_RF_BRUTE_FORCE_STOP = 0x65
CMD_RF_BRUTE_FORCE_STATUS_UPDATE = 0x66
CMD_RF_SET_TXRX_POWER_AMP_MODE = 0x67
CMD_RF_GET_TXRX_POWER_AMP_MODE = 0x70
CMD_RF_SET_RX_MODE_AUTO = 0x5A
CMD_RF_STOP_ALL = 0x71

# APP_SPECAN
CMD_RFCAT_START_SPECAN = 0x40
CMD_RFCAT_STOP_SPECAN = 0x41
CMD_SPECAN_PKT_DELAY = 0x42
CMD_SPECAN_QUEUE = 0x43

# APP_FREQFINDER

CMD_FREQFINDER_START = 0xA0
CMD_FREQFINDER_RESULT = 0xA1
CMD_FREQFINDER_STOP = 0xA2

# RF power amplifiers
RF_POWER_AMPLIFIERS_ACTION_ALL_OFF = 0x00         # action turn off amplifiers
RF_TX_POWER_AMPLIFIER_ACTION_ON = 0x01            # action turn on TX amplifier
RF_RX_POWER_AMPLIFIER_ACTION_ON = 0x02            # action turn on RX amplifier
RF_TX_RX_POWER_AMPLIFIER_ACTION_ON = 0x05         # action turn on TX & RX amplifiers (not supported by rev. E)
RF_TX_POWER_AMPLIFIER_ACTION_ON_TX = 0x06         # action turn on TX amplifier only when transmitting
RF_RX_POWER_AMPLIFIER_ACTION_ON_RX = 0x07         # action turn on RX amplifier only when receiving
RF_TX_RX_POWER_AMPLIFIER_ACTION_ON_TX_RX = 0x08   # action turn on TX & RX amplifiers only when transmitting & receiving
RF_ANT_POWER_ENABLE = 0x03                        # action enable antenna power
RF_ANT_POWER_DISABLE = 0x04                       # action disable antenna power

# Data rate measurement
USB_DATARATE_MEAS_WAIT_MS = 100
DATARATE_MEAS_OCC_THRESHOLD_DEFAULT = 100

# Brute Force
USB_BRUTEFORCE_STATUS_WAIT_MS = 5000
STATE_BRUTEFORCE_UNKNOWN = 0
STATE_BRUTEFORCE_NOT_STARTED = 1
STATE_BRUTEFORCE_ONGOING = 2
STATE_BRUTEFORCE_FINISHED = 3


# Registers

class Registers:
    """
    CC1111 common registers defines.
    """

    # Frequency registers
    FREQ2 = 0xDF09
    FREQ1 = 0xDF0A
    FREQ0 = 0xDF0B

    # Deviation register
    DEVIATN = 0xDF11

    # Sync Word registers
    SYNC_H = 0xDF00
    SYNC_L = 0xDF01

    # Packet Length register
    PKTLEN = 0xDF02

    # Packet Automation Control registers
    PKTCTRL0 = 0xDF04
    PKTCTRL1 = 0xDF03

    # Modem Configuration register
    MDMCFG1 = 0xDF0F
    MDMCFG2 = 0xDF0E

class RfUtils:
    """
    Utils defines for RF configuration.
    """

    # Frequency
    FREQ_LOW_MIN = 300000000
    FREQ_315 = 315000000
    FREQ_LOW_MAX = 348000000
    FREQ_MID_MIN = 391000000
    FREQ_434 = 434000000
    FREQ_MID_MAX = 464000000
    FREQ_HIGH_MIN = 782000000
    FREQ_867 = 867000000
    FREQ_868 = 868000000
    FREQ_869 = 869000000
    FREQ_HIGH_MAX = 928000000
    FREQ_DEFAULT = 433000000
    FREQ_REMOTE_1 = 433875000
    FREQ_REMOTE_2 = 868200000
    FREQ_915 = 915000000
    PLATFORM_CLOCK_FREQ = 24
    FREQ_REGISTERS_TO_REAL_FREQ_CONST = 1000000 / 0x10000

    FREQUENCY_VALUES = {
        #FREQ_LOW_MIN: FREQ_LOW_MIN,
        FREQ_315: FREQ_315,
        FREQ_DEFAULT: FREQ_DEFAULT,
        #FREQ_LOW_MAX: FREQ_LOW_MAX,
        #FREQ_MID_MIN: FREQ_MID_MIN,
        FREQ_434: FREQ_434,
        #FREQ_MID_MAX: FREQ_MID_MAX,
        #FREQ_HIGH_MIN: FREQ_HIGH_MIN,
        FREQ_867: FREQ_867,
        FREQ_868: FREQ_868,
        FREQ_869: FREQ_869,
        FREQ_915: FREQ_915,
        #FREQ_HIGH_MAX: FREQ_HIGH_MAX,
        FREQ_REMOTE_1: FREQ_REMOTE_1,
        FREQ_REMOTE_2: FREQ_REMOTE_2
    }

    Frequency_list = [FREQ_315, FREQ_434, FREQ_DEFAULT, FREQ_867, FREQ_868, FREQ_869, FREQ_915]

    # Max and min data rate in BAUD
    DATA_RATE_MAX = 500000
    DATA_RATE_MIN = 23

    # Max and min Rx filter bandwidth in Hz
    RX_FILTER_BANDWIDTH_MAX = 750000
    RX_FILTER_BANDWIDTH_MIN = 54000
    RX_DEFAULT_FILTER_BANDWIDTH = 150000

    RX_FILTER_BANDWIDTH_VALUES = {
        RX_FILTER_BANDWIDTH_MIN,
        63000, 75000, 94000,
        107000, 125000, 150000,
        188000, 214000, 250000,
        300000, 375000, 429000,
        500000, 600000, RX_FILTER_BANDWIDTH_MAX,
        RX_DEFAULT_FILTER_BANDWIDTH
    }

    # Max and min channel spacing in Hz
    CHANSPC_MAX = 374268
    CHANSPC_MIN = 23436

    # Power Amplifier Modes
    RF_POWER_AMPLIFIERS_ACTION_ALL_OFF = 0x00
    RF_TX_POWER_AMPLIFIER_ACTION_ON = 0x01
    RF_RX_POWER_AMPLIFIER_ACTION_ON = 0x02
    RF_TX_RX_POWER_AMPLIFIER_ACTION_ON = 0x05
    RF_TX_RX_POWER_AMPLIFIER_ACTION_ON_TX_RX = 0x08
    RF_ANT_POWER_ENABLE = 0x80
    RF_ANT_POWER_DISABLE = 0x00

    amp_modes = [
        RF_POWER_AMPLIFIERS_ACTION_ALL_OFF,
        RF_TX_POWER_AMPLIFIER_ACTION_ON,
        RF_RX_POWER_AMPLIFIER_ACTION_ON
    ]

    # Deviation
    CC1111_DEVIATION_MAX = 374268
    CC1111_DEVIATION_MIN = 23436

    # Modulation
    # MSK is only supported for data rates above 26 kBaud and cannot be used with Manchester enc/dec enabled.
    # GFSK, ASK and OOK is only supported for data rate up until 250 kBaud
    MOD_FORMAT_2_FSK = 0x00
    MOD_FORMAT_GFSK = 0x10
    MOD_FORMAT_ASK_OOK = 0x30
    MOD_FORMAT_MSK = 0x70
    MOD_INVERT = True
    MOD_NOT_INVERT = False

    mod_to_set = [
        MOD_FORMAT_2_FSK,
        MOD_FORMAT_ASK_OOK,
        MOD_FORMAT_GFSK,
        MOD_FORMAT_MSK
    ]

    # Sync Mode
    SYNC_MODE_NO_PRE = 0x00
    SYNC_MODE_15_16 = 0x01
    SYNC_MODE_16_16 = 0x02
    SYNC_MODE_30_32 = 0x03
    SYNC_MODE_NO_PRE_CS = 0x04
    SYNC_MODE_15_16_CS = 0x05
    SYNC_MODE_16_16_CS = 0x06
    SYNC_MODE_30_32_CS = 0x07

    sync_mode_to_set = [
        SYNC_MODE_NO_PRE,
        SYNC_MODE_NO_PRE_CS,
        SYNC_MODE_15_16,
        SYNC_MODE_15_16_CS,
        SYNC_MODE_16_16,
        SYNC_MODE_16_16_CS,
        SYNC_MODE_30_32,
        SYNC_MODE_30_32_CS
    ]